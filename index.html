<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Cadastro de Pessoas</title>
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <div class="main-grid">
      <div class="table-panel card">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;">
          <h1 style="font-size:1.5rem;margin:0;">Cadastro de Pessoas</h1>
          <button class="btn" id="addPersonBtn">Adicionar Pessoa</button>
        </div>
        <div>
          <label><input type="checkbox" id="hideDeleted" /> Ocultar registros excluídos</label>
        </div>
        <table id="peopleTable">
          <thead>
            <tr>
              <th>First Name</th>
              <th>Last Name</th>
              <th>Gender</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <div class="form-panel card" id="formPanel" style="display:none;">
        <form id="personForm">
          <input type="hidden" id="id" name="id" />
          <div>
            <label for="firstName">First Name</label>
            <input type="text" id="firstName" name="firstName" required />
          </div>
          <div>
            <label for="lastName">Last Name</label>
            <input type="text" id="lastName" name="lastName" required />
          </div>
          <div>
            <label for="gender">Gender</label>
            <select id="gender" name="gender">
              <option value="">-- selecione --</option>
              <option value="male">Male</option>
              <option value="female">Female</option>
              <option value="other">Other</option>
            </select>
          </div>
          <div class="full">
            <label for="notes">Notes</label>
            <textarea id="notes" name="notes"></textarea>
          </div>
          <!-- Datas serão exibidas no rodapé do card -->
          <div class="full">
            <button type="submit" id="saveBtn">Salvar</button>
            <button type="button" id="resetBtn">Limpar</button>
          </div>
        </form>
        <div id="datesInfo" style="font-size:0.85em;color:#666;margin-top:16px;text-align:right;"></div>
      </div>
    </div>
      .main-grid {
        display: grid;
        grid-template-columns: 1.2fr 1fr;
        gap: 32px;
        width: 100%;
        max-width: 1100px;
        margin: 0 auto;
        padding: 32px 0;
      }
      .table-panel {
        min-width: 0;
      }
      .form-panel {
        min-width: 0;
      }
      @media (max-width: 900px) {
        .main-grid {
          grid-template-columns: 1fr;
        }
        .form-panel {
          margin-top: 24px;
        }
      }

    <script>
            // Novo controle de exibição da ficha
            const formPanel = document.getElementById('formPanel');
            const addPersonBtn = document.getElementById('addPersonBtn');
            function showFormPanel(show = true) {
              formPanel.style.display = show ? 'block' : 'none';
            }
            addPersonBtn.addEventListener('click', function() {
              resetForm();
              showFormPanel(true);
            });
            // Modifica editPerson para mostrar ficha
            const originalEditPerson = editPerson;
            editPerson = function(id) {
              const people = loadPeople();
              const p = people.find(x => x.id === id);
              if (!p) return alert('Registro não encontrado');
              document.getElementById('id').value = p.id;
              document.getElementById('firstName').value = p.firstName || '';
              document.getElementById('lastName').value = p.lastName || '';
              document.getElementById('gender').value = p.gender || '';
              document.getElementById('notes').value = p.notes || '';
              // Exibe datas no rodapé
              showDatesInfo(p);
              showFormPanel(true);
            }
            // Oculta ficha ao salvar ou limpar
            document.getElementById('personForm').addEventListener('submit', function(e){
              e.preventDefault();
              const id = document.getElementById('id').value || generateUUID();
              const firstName = document.getElementById('firstName').value.trim();
              const lastName = document.getElementById('lastName').value.trim();
              const gender = document.getElementById('gender').value;
              const notes = document.getElementById('notes').value;
              const people = loadPeople();
              const existingIndex = people.findIndex(x => x.id === id);
              const now = nowISO();
              let createdAt = now;
              let deletedAt = null;
              if (existingIndex >= 0) {
                createdAt = people[existingIndex].createdAt || now;
                deletedAt = people[existingIndex].deletedAt || null;
                people[existingIndex] = {
                  ...people[existingIndex],
                  firstName, lastName, gender, notes,
                  updatedAt: now
                };
              } else {
                people.push({
                  id,
                  firstName,
                  lastName,
                  gender,
                  notes,
                  createdAt: now,
                  updatedAt: now,
                  deletedAt: null
                });
              }
              savePeople(people);
              renderTable();
              resetForm();
              showDatesInfo();
              showFormPanel(false);
            });
            document.getElementById('resetBtn').addEventListener('click', function(){
              resetForm();
              showDatesInfo();
              showFormPanel(false);
            });
            // Oculta ficha ao iniciar
            showFormPanel(false);
      const STORAGE_KEY = 'people:xpto';

      function nowISO() { return new Date().toISOString(); }

      function generateUUID() {
        if (crypto && crypto.randomUUID) return crypto.randomUUID();
        const bytes = crypto.getRandomValues(new Uint8Array(16));
        bytes[6] = (bytes[6] & 0x0f) | 0x40;
        bytes[8] = (bytes[8] & 0x3f) | 0x80;
        const b2h = b => Array.from(b).map(x => x.toString(16).padStart(2,'0')).join('');
        const s = b2h(bytes);
        return s.slice(0,8)+'-'+s.slice(8,12)+'-'+s.slice(12,16)+'-'+s.slice(16,20)+'-'+s.slice(20);
      }

      function loadPeople() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          return raw ? JSON.parse(raw) : [];
        } catch (e) {
          console.error('Erro ao ler storage', e);
          return [];
        }
      }

      function savePeople(people) { localStorage.setItem(STORAGE_KEY, JSON.stringify(people)); }

      function renderTable() {
        const tbody = document.querySelector('#peopleTable tbody');
        tbody.innerHTML = '';
        const people = loadPeople();
        const hideDeleted = document.getElementById('hideDeleted').checked;
        people.forEach(p => {
          if (hideDeleted && p.deletedAt) return;
          const tr = document.createElement('tr');
          if (p.deletedAt) tr.classList.add('deleted');
          tr.innerHTML = `
            <td>${escapeHtml(p.firstName)}</td>
            <td>${escapeHtml(p.lastName)}</td>
            <td>${p.gender || ''}</td>
            <td class="actions">
              <button data-id="${p.id}" class="edit">Editar</button>
              <button data-id="${p.id}" class="del">Excluir</button>
            </td>
          `;
          tbody.appendChild(tr);
        });
      }

      function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

      function resetForm() {
        document.getElementById('personForm').reset();
        document.getElementById('id').value = '';
      }

      function formatDate(dateStr) {
        if (!dateStr) return '';
        const d = new Date(dateStr);
        if (isNaN(d)) return escapeHtml(dateStr);
        const pad = n => n.toString().padStart(2, '0');
        const day = pad(d.getDate());
        const month = pad(d.getMonth() + 1);
        const year = d.getFullYear();
        const hour = pad(d.getHours());
        const min = pad(d.getMinutes());
        return `${day}-${month}-${year} ${hour}:${min}`;
      }

      function showDatesInfo(person) {
        const el = document.getElementById('datesInfo');
        if (!el) return;
        if (!person) {
          el.innerHTML = '';
          return;
        }
        let html = '';
        if (person.createdAt) html += `<div>Criado em: <span>${formatDate(person.createdAt)}</span></div>`;
        if (person.updatedAt) html += `<div>Atualizado em: <span>${formatDate(person.updatedAt)}</span></div>`;
        if (person.deletedAt) html += `<div>Excluído em: <span>${formatDate(person.deletedAt)}</span></div>`;
        el.innerHTML = html;
      }

      document.getElementById('personForm').addEventListener('submit', function(e){
        e.preventDefault();
        const id = document.getElementById('id').value || generateUUID();
        const firstName = document.getElementById('firstName').value.trim();
        const lastName = document.getElementById('lastName').value.trim();
        const gender = document.getElementById('gender').value;
        const notes = document.getElementById('notes').value;
        const createdAtField = document.getElementById('createdAt').value;
        const deletedAtField = document.getElementById('deletedAt').value || null;

        const people = loadPeople();
        const existingIndex = people.findIndex(x => x.id === id);
        const now = nowISO();

        if (existingIndex >= 0) {
          people[existingIndex] = {
            ...people[existingIndex],
            firstName, lastName, gender, notes,
            updatedAt: now,
            deletedAt: deletedAtField || null
          };
        } else {
          people.push({
            id,
            firstName,
            lastName,
            gender,
            notes,
            createdAt: createdAtField || now,
            updatedAt: now,
            deletedAt: deletedAtField || null
          });
        }

        savePeople(people);
        renderTable();
        resetForm();
      });

      document.getElementById('resetBtn').addEventListener('click', function(){ resetForm(); });

      document.getElementById('peopleTable').addEventListener('click', function(e){
        const id = e.target.getAttribute('data-id');
        if (!id) return;
        if (e.target.classList.contains('edit')) {
          editPerson(id);
        } else if (e.target.classList.contains('del')) {
          softDeletePerson(id);
        }
      });

      document.getElementById('hideDeleted').addEventListener('change', renderTable);

      function editPerson(id) {
        const people = loadPeople();
        const p = people.find(x => x.id === id);
        if (!p) return alert('Registro não encontrado');
        document.getElementById('id').value = p.id;
        document.getElementById('firstName').value = p.firstName || '';
        document.getElementById('lastName').value = p.lastName || '';
        document.getElementById('gender').value = p.gender || '';
        document.getElementById('notes').value = p.notes || '';
        document.getElementById('createdAt').value = p.createdAt || '';
        document.getElementById('updatedAt').value = p.updatedAt || '';
        document.getElementById('deletedAt').value = p.deletedAt || '';
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }

      function softDeletePerson(id) {
        if (!confirm('Confirmar exclusão (soft delete)?')) return;
        const people = loadPeople();
        const i = people.findIndex(x => x.id === id);
        if (i < 0) return alert('Registro não encontrado');
        people[i].deletedAt = nowISO();
        people[i].updatedAt = nowISO();
        savePeople(people);
        renderTable();
      }

      renderTable();
    </script>
  </body>
</html>
