<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>myLineage ‚Äî Bem-vindo</title>
    <link rel="stylesheet" href="landing.css">
    <script src="remote-storage.js"></script>
  </head>
  <body>
    <header class="lp-header">
      <div class="lp-brand">
        <div class="lp-logo" aria-hidden="true">üå≥</div>
        <div>
          <h1>myLineage</h1>
          <p class="muted">Explorar e gerir a sua hist√≥ria familiar</p>
        </div>
      </div>
      <div class="lp-actions">
        <button id="themeToggle" class="icon-btn" aria-label="Alternar tema">üåì</button>
      </div>
    </header>

    <main class="lp-main">
      <section class="hero">
        <div class="hero-content">
          <h2>Descubra gera√ß√µes, preserve mem√≥rias</h2>
          <p class="lead">Importe, explore e conecte registos geneal√≥gicos com ferramentas simples e seguras.</p>
          <div class="hero-cta">
            <a class="btn primary" href="app.html">Abrir Aplica√ß√£o</a>
            <a class="btn" href="arvore.html">Ver √Årvore</a>
          </div>
        </div>
        <div class="hero-visual" aria-hidden="true">
          <svg viewBox="0 0 600 400" preserveAspectRatio="xMidYMid meet">
            <defs>
              <linearGradient id="g1" x1="0" x2="1">
                <stop offset="0" stop-color="var(--accent)" stop-opacity="0.9"/>
                <stop offset="1" stop-color="var(--accent-2)" stop-opacity="0.7"/>
              </linearGradient>
            </defs>
            <rect width="100%" height="100%" fill="url(#g1)"></rect>
            <g fill="rgba(255,255,255,0.15)">
              <circle cx="480" cy="80" r="60"></circle>
              <circle cx="520" cy="140" r="40"></circle>
              <circle cx="420" cy="200" r="28"></circle>
            </g>
            <text x="40" y="260" fill="rgba(255,255,255,0.9)" font-size="34">√Årvore geneal√≥gica</text>
          </svg>
        </div>
      </section>

      <!-- Dados atuais -->
      <section class="dados-atuais" id="dados-atuais">
        <h2 class="section-title">Dados atuais</h2>
        <div class="dados-grid">
          <div class="dado-card">
            <div class="dado-value" id="da-pessoas">‚Äî</div>
            <div class="dado-label">Pessoas</div>
          </div>
          <div class="dado-card">
            <div class="dado-value" id="da-vivas">‚Äî</div>
            <div class="dado-label">Pessoas vivas</div>
          </div>
          <div class="dado-card">
            <div class="dado-value" id="da-familias">‚Äî</div>
            <div class="dado-label">Fam√≠lias</div>
          </div>
          <div class="dado-card">
            <div class="dado-value" id="da-eventos">‚Äî</div>
            <div class="dado-label">Eventos</div>
          </div>
        </div>
      </section>

      <!-- Anivers√°rios -->
      <section class="aniversarios-section" id="aniversarios-section">
        <h2 class="section-title">üéÇ Anivers√°rios</h2>
        <div class="aniv-list" id="aniv-list">
          <p class="aniv-empty muted">A carregar‚Ä¶</p>
        </div>
      </section>

      <section class="links-grid">
        <div class="card">
          <h3>Entrar na aplica√ß√£o</h3>
          <p>Aceda ao modo aplica√ß√£o com todas as ferramentas de gest√£o.</p>
          <div class="card-links">
            <a href="app.html">Modo Aplica√ß√£o (UI Completa)</a>
            <a href="gedcom.html">GEDCOM (Importar / Exportar)</a>
          </div>
        </div>

        <div class="card">
          <h3>Pesquisar genealogia</h3>
          <p>Links r√°pidos para sites de pesquisa geneal√≥gica.</p>
          <div class="card-links">
            <a href="https://www.myheritage.com" target="_blank" rel="noopener noreferrer">MyHeritage</a>
            <a href="https://www.familysearch.org" target="_blank" rel="noopener noreferrer">FamilySearch</a>
            <a href="https://www.ancestry.com" target="_blank" rel="noopener noreferrer">Ancestry</a>
            <a href="https://www.findmypast.com" target="_blank" rel="noopener noreferrer">Findmypast</a>
          </div>
        </div>

        <div class="card">
          <h3>Recursos</h3>
          <p>Configura√ß√µes e indicadores.</p>
          <div class="card-links">
            <a href="apis.html">APIs</a>
            <a href="configuracao.html">Defini√ß√µes</a>
            <a href="indicadores.html">Indicadores</a>
            <a href="pessoa-detalhe.html">Detalhe de Pessoa</a>
          </div>
        </div>
      </section>
    </main>

    <footer class="lp-footer">
      <div>¬© <span id="year"></span> myLineage</div>
      <div class="muted">Feito para gest√£o de arquivos familiares ‚Ä¢ GEDCOM ready</div>
    </footer>

    <script>
      // Theme toggle persisted in localStorage
      const body = document.documentElement;
      const btn = document.getElementById('themeToggle');
      const current = localStorage.getItem('mylineage:theme') || 'light';
      if (current === 'dark') body.classList.add('dark');
      btn.addEventListener('click', () => {
        const dark = body.classList.toggle('dark');
        localStorage.setItem('mylineage:theme', dark ? 'dark' : 'light');
      });
      document.getElementById('year').textContent = new Date().getFullYear();

      // ‚îÄ‚îÄ Dados atuais + Anivers√°rios ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      (function () {
        function getPeople() { try { return JSON.parse(localStorage.getItem('people:myLineage') || '[]'); } catch(e) { return []; } }
        function getEvents() { try { return JSON.parse(localStorage.getItem('events:myLineage') || '[]'); } catch(e) { return []; } }
        function getRelations() { try { return JSON.parse(localStorage.getItem('relations:myLineage') || '[]'); } catch(e) { return []; } }

        const people    = getPeople().filter(p => !p.deletedAt);
        const events    = getEvents().filter(e => !e.deletedAt);
        const relations = getRelations().filter(r => !r.deletedAt);

        // Pessoas vivas = sem evento DEATH
        const deathIds = new Set(events.filter(e => e.type === 'DEATH').map(e => e.personId));
        const living   = people.filter(p => !deathIds.has(p.id));

        // Dados atuais
        document.getElementById('da-pessoas').textContent  = people.length;
        document.getElementById('da-vivas').textContent    = living.length;
        document.getElementById('da-familias').textContent = relations.length;
        document.getElementById('da-eventos').textContent  = events.length;

        // Anivers√°rios ‚Äì pr√≥ximos 3 em pessoas vivas
        const today = new Date();
        today.setHours(0, 0, 0, 0);

        const upcoming = [];
        living.forEach(p => {
          const birth = events.find(e => e.personId === p.id && e.type === 'BIRTH');
          if (!birth || !birth.date) return;
          const bd = new Date(birth.date);
          if (isNaN(bd)) return;

          const birthYear  = bd.getFullYear();
          const birthMonth = bd.getMonth();
          const birthDay   = bd.getDate();

          let next = new Date(today.getFullYear(), birthMonth, birthDay);
          next.setHours(0, 0, 0, 0);
          if (next < today) next = new Date(today.getFullYear() + 1, birthMonth, birthDay);

          const daysUntil   = Math.round((next - today) / 86400000);
          const ageWillTurn = next.getFullYear() - birthYear;
          const name        = [p.firstName, p.lastName].filter(Boolean).join(' ') || '(sem nome)';

          upcoming.push({ name, daysUntil, ageWillTurn, next });
        });

        upcoming.sort((a, b) => a.daysUntil - b.daysUntil);
        const top3 = upcoming.slice(0, 3);

        const listEl = document.getElementById('aniv-list');
        if (top3.length === 0) {
          listEl.innerHTML = '<p class="aniv-empty muted">Sem anivers√°rios registados.</p>';
          return;
        }

        const monthNames = ['jan','fev','mar','abr','mai','jun','jul','ago','set','out','nov','dez'];
        listEl.innerHTML = top3.map(item => {
          const dateStr  = item.next.getDate() + ' ' + monthNames[item.next.getMonth()];
          const daysText = item.daysUntil === 0 ? 'hoje!' : item.daysUntil === 1 ? 'amanh√£' : 'em ' + item.daysUntil + ' dias';
          return `<div class="aniv-item">
            <div class="aniv-avatar">${item.name.charAt(0).toUpperCase()}</div>
            <div class="aniv-info">
              <div class="aniv-name">${item.name}</div>
              <div class="aniv-meta muted">${dateStr} ¬∑ faz ${item.ageWillTurn} anos ¬∑ <span class="aniv-days">${daysText}</span></div>
            </div>
          </div>`;
        }).join('');
      })();
    </script>
  </body>
</html>
